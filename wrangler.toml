# Cloudflare Workers Configuration
# Docs: https://developers.cloudflare.com/workers/wrangler/configuration/

name = "investigaree"
main = "workers/index.ts"
compatibility_date = "2025-04-01"
compatibility_flags = ["nodejs_compat"]

# Account info (preencher após criar Workers)
account_id = "ce11d202b2917777965b5131b5edc627"
workers_dev = true

# Build configuration
[build]
command = "npm run build"
upload.format = "service-worker"

# KV Namespaces (para cache)
[[kv_namespaces]]
binding = "KV"
id = "afa4a891f4994709977bcd583fb3f285" # investigaree-rate-limits
preview_id = "" # wrangler kv:namespace create "KV" --preview

# Routes (produção)
[[routes]]
pattern = "investigaree.com.br/*"
zone_name = "investigaree.com.br"

# Static site configuration
[site]
bucket = "./dist"

# Environment variables (não-sensíveis)
[vars]
ENVIRONMENT = "production"
APP_VERSION = "1.0.0"

# ============================================
# PRODUCTION ENVIRONMENT
# ============================================
[env.production]
name = "investigaree-prod"
vars = { ENVIRONMENT = "production" }

# ============================================
# STAGING ENVIRONMENT
# ============================================
[env.staging]
name = "investigaree-staging"
vars = { ENVIRONMENT = "staging" }

# ============================================
# DEVELOPMENT
# ============================================
[env.development]
name = "investigaree-dev"
vars = { ENVIRONMENT = "development" }

# ============================================
# OBSERVABILITY (opcional - para logs avançados)
# ============================================
[observability]
enabled = true

# ============================================
# TRIGGERS (Cron Jobs para processar relatórios)
# ============================================
[triggers]
crons = ["0 */6 * * *"] # Rodar a cada 6 horas

# ============================================
# USAGE MODEL
# ============================================
usage_model = "bundled" # ou "unbound" para workloads pesados

# ============================================
# LIMITS
# ============================================
[limits]
cpu_ms = 50 # 50ms no free tier, até 50.000ms no paid

# ============================================
# SECRETS (adicionar via: wrangler secret put NOME_SECRET)
# ============================================
# SUPABASE_SERVICE_ROLE_KEY
# FIREBASE_ADMIN_CREDENTIALS
# STRIPE_SECRET_KEY
# STRIPE_WEBHOOK_SECRET
# OPENAI_API_KEY
# GOOGLE_API_KEY
# API_BRASIL_BEARER_TOKEN
# API_BRASIL_DEVICE_TOKEN
# DEHASHED_EMAIL
# DEHASHED_API_KEY
# URL_SECRET
# JWT_SECRET

# ============================================
# NOTES
# ============================================
# 1. Adicionar secrets: npx wrangler secret put SECRET_NAME
# 2. Ver secrets: npx wrangler secret list
# 3. Deploy: npx wrangler deploy
# 4. Logs: npx wrangler tail
# 5. KV namespaces: wrangler kv:namespace create "NOME"
